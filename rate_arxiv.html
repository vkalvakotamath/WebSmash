<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSmash - arXiv Edition</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
         body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        
        h1 {
            background: #821b1b;
            padding: 20px 0;
            text-align: center;
            color: #ffffff;
        }
        h3 {
            text-align: center;
        }
        #paperContainer {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .paper {
            width: 45%;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s;
        }
        .paper:hover {
            transform: scale(1.05);
        }
        .paper h2 {
            font-size: 18px;
            margin-top: 0;
        }
        .paper p {
            font-size: 14px;
        }
        #rankings {
            margin-top: 20px;
            text-align: center;
        }
        a {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: #4CAF50;
            text-decoration: none;
        }
        
        .restart-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .restart-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>WebSmash | arXiv Edition</h1>
    <h3>Which paper would you rather read?</h3><br>
    <div id="paperContainer"></div>
    <div id="rankings"></div>
    <p id="progress"></p>
    <button class="restart-button" onclick="window.location.href='/restart'">Restart Ranking</button>

    <script>
        function loadCombination() {
            $.getJSON('/get_combination', function(data) {
                if (data.finished) {
                    window.location.href = '/win';
                } else {
                    let html = `
                        <div class="paper" onclick="selectWinner('${data.paper1.id}', '${data.paper2.id}')">
                            <h2>${data.paper1.title}</h2>
                            <p><strong>Authors:</strong> ${data.paper1.authors}</p>
                            <p>${data.paper1.abstract}</p>
                            <a href="${data.paper1.pdf_url}" target="_blank">View PDF</a>
                        </div>
                        <div class="paper" onclick="selectWinner('${data.paper2.id}', '${data.paper1.id}')">
                            <h2>${data.paper2.title}</h2>
                            <p><strong>Authors:</strong> ${data.paper2.authors}</p>
                            <p>${data.paper2.abstract}</p>
                            <a href="${data.paper2.pdf_url}" target="_blank">View PDF</a>
                        </div>
                    `;
                    $('#paperContainer').html(html);
                    // $('#progress').text(`Combinations left: ${data.combinations_left}`);
                }
            });
        }

        function selectWinner(winner, loser) {
            $.ajax({
                url: '/update_ratings',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({winner: winner, losers: [loser]}),
                success: function() {
                    loadCombination();
                }
            });
        }

        loadCombination();


          
    function updateRankings() {
        fetch('/get_rankings')
            .then(response => response.json())
            .then(data => {
                const rankings = document.getElementById('rankings');
                rankings.innerHTML = '<h3>Current Rankings:</h3>';
                const list = document.createElement('ol');
                data.slice(0, 10).forEach(([paperId, score]) => {
                    const paper = papers.find(p => p.id === paperId);
                    const item = document.createElement('li');
                    item.textContent = `${paper.title} (${Math.round(score)})`;
                    list.appendChild(item);
                });
                rankings.appendChild(list);
            });
    }
    </script>



<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    MathJax.typesetPromise().catch((err) => console.log(err));
  });
</script>

<div style="text-align: right; padding: 10px;">
    <a href="{{ url_for('about') }}" class="button">About</a>
</body>
</html>